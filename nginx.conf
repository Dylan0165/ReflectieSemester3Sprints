server {
  listen 80;
  server_name _;

  root /usr/share/nginx/html;
  index index.html;

  # Prevent any kind of redirects
  absolute_redirect off;
  port_in_redirect off;
  
  # Disable adding trailing slashes to directories
  if ($request_uri ~ ^(.+)/$) {
    return 301 $1;
  }

  # Global CORS headers for all responses
  add_header 'Access-Control-Allow-Origin' '*' always;
  add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
  add_header 'Access-Control-Allow-Headers' 'Origin, Content-Type, Accept, Authorization' always;

  # Exact match for root
  location = / {
    try_files /index.html =404;
  }

  # Static assets in /assets folder - case insensitive, no trailing slash allowed
  location ^~ /assets/ {
    add_header 'Access-Control-Allow-Origin' '*' always;
    add_header 'Cache-Control' 'public, max-age=31536000, immutable';
    expires 1y;
    access_log off;
    
    # If request ends with /, remove it
    rewrite ^(.*)/$ $1 permanent;
    
    # Serve the file or 404
    try_files $uri =404;
  }

  # All other routes - SPA fallback
  location / {
    add_header 'Access-Control-Allow-Origin' '*' always;
    try_files $uri /index.html;
  }
}
